# 索引

## 索引类型

### 聚簇索引

在InnoDB存储引擎中，聚簇索引就是数据的存储方式，也就是所谓的“索引即数据，数据即索引”。

聚簇索引只能在搜索条件是主键值时才能发挥作用，原因是B+树中的数据都是按照主键进行排序的。

- **记录**：按照主键的大小顺序排成一个单向链表；页内的记录被划分成若干个组，每个组中主键值最大的记录在页内的偏移量会被当作槽依次存放在页目录中。
- **页**：按照主键的大小顺序排成一个双向链表；存放目录项记录的也分为不同的层级，同层页中的目录项记录的主键大小顺序排成一个双向链表。

### 非聚簇索引

当我们要提高搜索非主键列的查询速度时，就涉及到给这个列创建二级索引了。

二级索引的叶子节点并没有完整的用户记录，所以还需要通过携带主键信息到聚簇索引中重新定位完整的用户记录的过程也成为回表。

### 联合索引

同时为多个列建立索引，即联合索引

## 索引什么时候失效

1. 有or必全有索引;

> 如果条件中有or，即使其中有部分条件带索引也不会使用(这也是为什么尽量少用or的原因)，例子中user_id无索引

2. 复合索引未用左列字段;

> 对于复合索引，如果不使用前列，后续列也将无法使用，类电话簿。

3. like以%开头;

4. 需要类型转换;

> 存在索引列的数据类型隐形转换，则用不上索引，比如列类型是字符串，那一定要在条件中将数据使用引号引用起来,否则不使用索引

5. where中索引列有运算;

> where 子句里对索引列上有数学运算，用不上索引

6. where中索引列使用了函数;

> where 子句里对有索引列使用函数，用不上索引

7. 如果mysql觉得全表扫描更快时（数据少）;

## 没有必要用索引

1. 唯一性差;

> 比如性别，只有两种可能数据。意味着索引的二叉树级别少，多是平级。这样的二叉树查找无异于全表扫描。

2. 频繁更新的字段不用（更新索引消耗）;

> 比如logincount登录次数，频繁变化导致索引也频繁变化，增大数据库工作量，降低效率。

3. where中不用的字段;

> 只有在where语句出现，mysql才会去使用索引

4. 索引使用<>时，效果一般;

## 参考

[MySQL-有哪些索引](http://www.zyiz.net/tech/detail-252439.html)